(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{449:function(t,s,e){"use strict";e.r(s);var a=e(35),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#events"}},[t._v("#")]),t._v(" Events")]),t._v(" "),e("p",[t._v("Events are objects that contain information about the execution of the application. They are mainly used by service providers like block explorers and wallet to track the execution of various messages and index transactions.")]),t._v(" "),e("h3",{attrs:{id:"subscribing-to-events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#subscribing-to-events"}},[t._v("#")]),t._v(" Subscribing to Events")]),t._v(" "),e("h4",{attrs:{id:"cosmos-and-tendermint-events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cosmos-and-tendermint-events"}},[t._v("#")]),t._v(" Cosmos and Tendermint Events")]),t._v(" "),e("p",[t._v("It is possible to subscribe to "),e("code",[t._v("Events")]),t._v(" via Tendermint's "),e("a",{attrs:{href:"https://docs.tendermint.com/v0.34/tendermint-core/subscription.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Websocket"),e("OutboundLink")],1),t._v(". This is done by calling the "),e("code",[t._v("subscribe")]),t._v(" RPC method via Websocket:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subscribe"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"params"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"tm.event='<event_value>' AND eventType.eventAttribute='<attribute_value>'\"")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("These events are triggered after a block is committed. You can get the full list of "),e("code",[t._v("event")]),t._v(" categories and values (here)[/en/for_web3_dev/metaos_client.html#list-of-tendermint-events].")]),t._v(" "),e("p",[t._v("The type and attribute value of the query allow you to filter the specific event you are looking for. For example, a an Ethereum transaction on MetaOS ("),e("code",[t._v("MsgEthereumTx")]),t._v(") triggers an "),e("code",[t._v("event")]),t._v(" of type "),e("code",[t._v("ethermint")]),t._v(" and has "),e("code",[t._v("sender")]),t._v(" and "),e("code",[t._v("recipient")]),t._v(" as "),e("code",[t._v("attributes")]),t._v(". Subscribing to this event would be done like so:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subscribe"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"params"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"tm.event='Tx' AND ethereum.recipient='hexAddress'\"")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("where "),e("code",[t._v("hexAddress")]),t._v(" is an Ethereum hex address (eg: "),e("code",[t._v("0x1122334455667788990011223344556677889900")]),t._v(").")]),t._v(" "),e("h4",{attrs:{id:"ethereum-events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ethereum-events"}},[t._v("#")]),t._v(" Ethereum Events")]),t._v(" "),e("p",[t._v("MetaOS also supports the Ethereum JSON-RPC filters calls to subscribe to "),e("a",{attrs:{href:"https://eth.wiki/json-rpc/API#eth_newfilter",target:"_blank",rel:"noopener noreferrer"}},[t._v("state logs"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://eth.wiki/json-rpc/API#eth_newblockfilter",target:"_blank",rel:"noopener noreferrer"}},[t._v("blocks"),e("OutboundLink")],1),t._v(" or "),e("a",{attrs:{href:"https://eth.wiki/json-rpc/API#eth_newpendingtransactionfilter",target:"_blank",rel:"noopener noreferrer"}},[t._v("pending transactions"),e("OutboundLink")],1),t._v(" changes.")]),t._v(" "),e("p",[t._v("Under the hood, it uses the Tendermint RPC client's event system to process subscriptions that are then formatted to Ethereum-compatible events.")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X POST --data "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"jsonrpc":"2.0","method":"eth_newBlockFilter","params":[],"id":1}\'')]),t._v(" -H "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type: application/json"')]),t._v(" http://localhost:8545\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),t._v(":1,"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"result"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x3503de5f0c766c68f78a03a3b05036a5"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Then you can check if the state changes with the "),e("RouterLink",{attrs:{to:"/en/for_web3_dev/jsonrpc_method.html#eth-getfilterchanges"}},[t._v("eth_getFilterChanges")]),t._v(" call:")],1),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X POST --data "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"jsonrpc":"2.0","method":"eth_getFilterChanges","params":["0x3503de5f0c766c68f78a03a3b05036a5"],"id":1}\'')]),t._v(" -H "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type: application/json"')]),t._v(" http://localhost:8545\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),t._v(":1,"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"result"')]),t._v(":"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x7d44dceff05d5963b5bc81df7e9f79b27e777b0a03a6feca09f3447b99c6fa71"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x3961e4050c27ce0145d375255b3cb829a5b4e795ac475c05a219b3733723d376"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0xd7a497f95167d63e6feca70f344d9f6e843d097b62729b8f43bdcd5febf142ab"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x55d80a4ba6ef54f2a8c0b99589d017b810ed13a1fda6a111e1b87725bc8ceb0e"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x9e8b92c17280dd05f2562af6eea3285181c562ebf41fc758527d4c30364bcbc4"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x7353a4b9d6b35c9eafeccaf9722dd293c46ae2ffd4093b2367165c3620a0c7c9"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x026d91bda61c8789c59632c349b38fd7e7557e6b598b94879654a644cfa75f30"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x73e3245d4ddc3bba48fa67633f9993c6e11728a36401fa1206437f8be94ef1d3"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"websocket-connection"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#websocket-connection"}},[t._v("#")]),t._v(" Websocket Connection")]),t._v(" "),e("h4",{attrs:{id:"tendermint-websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tendermint-websocket"}},[t._v("#")]),t._v(" Tendermint Websocket")]),t._v(" "),e("p",[t._v("To start a connection with the Tendermint websocket you need to define the address with the "),e("code",[t._v("--rpc.laddr")]),t._v(" flag when starting the node (default "),e("code",[t._v("tcp://127.0.0.1:26657")]),t._v("):")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("metaosd start --rpc.laddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tcp://127.0.0.1:26657"')]),t._v("\n")])])]),e("p",[t._v("Then, start a websocket subscription with ws")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# connect to tendermint websocket at port 8080 as defined above")]),t._v("\nws ws://localhost:8080/websocket\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# subscribe to new Tendermint block headers")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subscribe"')]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"params"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"tm.event='NewBlockHeader'\"")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h4",{attrs:{id:"ethereum-websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ethereum-websocket"}},[t._v("#")]),t._v(" Ethereum Websocket")]),t._v(" "),e("p",[t._v("Since MetaOS runs uses Tendermint Core as it's consensus Engine and it's built with the Cosmos SDK framework,\nit inherits the event format from them. However, in order to support the native Web3 compatibility for websockets of the "),e("a",{attrs:{href:"https://geth.ethereum.org/docs/rpc/pubsub",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ethereum's PubSubAPI"),e("OutboundLink")],1),t._v(", MetaOS needs to cast the Tendermint responses retrieved into the Ethereum types.")]),t._v(" "),e("p",[t._v("You can start a connection with the Ethereum websocket using the "),e("code",[t._v("--json-rpc.ws-address")]),t._v(" flag when starting the node (default "),e("code",[t._v('"0.0.0.0:8546"')]),t._v("):")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("metaosd start  --json-rpc.address"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:8545"')]),t._v(" --json-rpc.ws-address"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:8546"')]),t._v(" --evm.rpc.api"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eth,web3,net,txpool,debug"')]),t._v(" --json-rpc.enable\n")])])]),e("p",[t._v("Then, start a websocket subscription with "),e("a",{attrs:{href:"https://github.com/hashrocket/ws",target:"_blank",rel:"noopener noreferrer"}},[t._v("ws"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# connect to tendermint websocet at port 8546 as defined above")]),t._v("\nws ws://localhost:8546/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# subscribe to new Ethereum-formatted block Headers")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"method"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eth_subscribe"')]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"params"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"newHeads"')]),t._v(", "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonrpc"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"result"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x44e010cb2c3161e9c02207ff172166ef"')]),t._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),t._v(":1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);